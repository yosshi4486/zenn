---
title: "NSTreeControllerã§ç™ºç”Ÿã™ã‚‹removeObjectIdenticalTo:]:unrecognized selector sent to instance xxxã®åŸå› ãƒ»è§£æ±º"
emoji: "ğŸ¦"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Cocoa, AppKit, NSTreeController, ã‚¨ãƒ©ãƒ¼è§£æ±º]
published: true
---

ä¸‹è¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ©ãƒ ã«ã—ã‹æƒ…å ±ãŒãªã‹ã£ãŸã®ã§ã€æ—¥æœ¬èªæƒ…å ±ã®ãŸã‚ã«æŠ•ç¨¿ã—ã¾ã™ã€‚
https://developer.apple.com/forums/thread/45120

è‡ªä½œãƒ¢ãƒ‡ãƒ«ã¨NSTreeControllerã‚’Bindingã—ã¦ä½¿ã£ã¦ã„ã‚‹ã¨ãã«`-[xxxArray removeObjectIdenticalTo:]:unrecognized selector sent to instance xxx`ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã«é­é‡ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

çµè«–ã‹ã‚‰è¨€ã†ã¨ã€ã“ã®`removeObjectIdenticalTo:`ã¨ã„ã†ã®ã¯[NSMutableArray](https://developer.apple.com/documentation/foundation/nsmutablearray)ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã€ä¸Šè¨˜ã®ã‚¨ãƒ©ãƒ¼ã¯ã€ŒSwiftã§æä¾›ã•ã‚Œã‚‹Arrayã«å¯¾ã—ã¦ã€å­˜åœ¨ã—ãªã„Objcãƒ™ãƒ¼ã‚¹ã®NSMutableArrayã«ã—ã‹ãªã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã—ã¦ã—ã¾ã„ã¾ã—ãŸã‚ˆã€ã¨ã„ã†ã‚¨ãƒ©ãƒ¼ã§ã™ã€‚

ã©ã†ã‚„ã‚‰NSTreeControllerã®[move(_:to:)](https://developer.apple.com/documentation/appkit/nstreecontroller/1532133-move)ä¸€éƒ¨ã®APIã¯ã€å†…éƒ¨ã®å®Ÿè£…ãŒNSMutableArrayã‚’å‰æã¨ã—ã¦å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ãã€ãƒ¢ãƒ‡ãƒ«ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®Ÿè£…ã—ãŸSwift.Arrayã‚’bindingã§æ¸¡ã—ã¦ã„ã‚‹å ´åˆã¯ã€ã“ã‚Œã‚‰ã®APIä½¿ç”¨æ™‚ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¦ã—ã¾ã„ã¾ã™ã€‚(5å¹´ä»¥ä¸Šå‰ã‹ã‚‰èªçŸ¥ã•ã‚Œã¦ã„ã‚‹å•é¡Œã®ã‚ˆã†ã§ã™ãŒã€ä¿®æ­£ã•ã‚Œã‚‹æ°—é…ã¯ã‚ã‚Šã¾ã›ã‚“)

ã“ã®å•é¡Œã®ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰ã¨ãŒ2ç¨®é¡ã‚ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚
1. ãƒ¢ãƒ‡ãƒ«ã®å®Ÿè£…ã‚’NSMutableArrayã§å®Ÿè£…ã—ã¦ã—ã¾ã†
2. computed propertyã¨ã—ã¦NSMutableArrayã‚’è¿”ã™

ã—ã‹ã—ã€1.ã®æ–¹ã¯ãƒ¢ãƒ‡ãƒ«ã‚’NSMutableArrayå‰æã§æ›¸ãæ›ãˆã¦ã—ã¾ã„ã€SwiftUIã‚‚å«ã‚Pure Swiftã«å‘ã‹ã£ã¦ã„ãæŠ€è¡“å‹•å‘ã«é€†ã‚‰ã£ã¦ã„ã‚‹æ–¹é‡ã®ãŸã‚ã€ãªã‚‹ã¹ãé¿ã‘ãŸã„ã§ã™ã€‚
ãªã®ã§ã€ç§ã¯2.ã®æ–¹é‡ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ãƒ¢ãƒ‡ãƒ«å®Ÿè£…è‡ªä½“ã¯Swift.Arrayã‚’åˆ©ç”¨ã—ã€computed propertyã§NSMutableArrayã‚’è¿”ã—ã¾ã™ã€‚ä¸‹è¨˜ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚åŒã˜ã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã§å›°ã£ã¦ã„ã‚‹æ™‚ã¯å‚è€ƒã«ãŠä½¿ã„ãã ã•ã„ã€‚

```swift
class Model: NSObject {

    var children: [Node] {
        willSet { willChangeValue(forKey: #keyPath(mutableChildren)) }
        didSet { didChangeValue(forKey: #keyPath(mutableChildren)) }
    }

}

extension Model {

    @objc dynamic var mutableChildren: NSMutableArray {
        get {
            return NSMutableArray(array: children)
        }
        set {
            children = Array(_immutableCocoaArray: newValue)
        }
    }

}

```

ã“ã“ã¾ã§å•é¡Œã®åŸå› ã¨è§£æ±ºæ³•(ãƒ¯ãƒ¼ã‚¯ã‚¢ãƒ©ã‚¦ãƒ³ãƒ‰)ã‚’ç´¹ä»‹ã—ã¾ã—ãŸãŒã€ã‚ˆã‚Šè‰¯ã„è¨­è¨ˆæ–¹æ³•ç­‰ã‚ã‚Œã°ã‚³ãƒ¡ãƒ³ãƒˆæ­“è¿è‡´ã—ã¾ã™ã€‚