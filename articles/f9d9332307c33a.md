---
title: "NSTextFieldã§NSEventã®ã‚­ãƒ¼ã‚’è¦‹ã¦ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰"
emoji: "ğŸ¤–"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Cocoa, AppKit, NSTextField]
published: true
---

swiftã‚’ä½¿ã£ãŸã‚µãƒ³ãƒ—ãƒ«ã§ã™ã€‚[NSControlTextEditingDelegate.control(_:textView:doCommandBy:)](https://developer.apple.com/documentation/appkit/nscontroltexteditingdelegate/1428898-control)ã‚’ä½¿ã„ã¾ã™ã€‚

```swift
func control(_ control: NSControl, textView: NSTextView, doCommandBy commandSelector: Selector) -> Bool {

    switch commandSelector {
    case #selector(insertNewline):
        // ã“ã®delegateãƒ¡ã‚½ãƒƒãƒ‰ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹ã¯ã“ã¡ã‚‰. 
        doSomethingYouWant()
        // è‡ªå‰ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**ã™ã‚‹å ´åˆã¯trueã‚’è¿”ã™**
        return true
        
    default:
        
        /*
         Field Editorã§å®šç¾©ã•ã‚Œã¦ã„ã‚‹ã‚¤ãƒ™ãƒ³ãƒˆä»¥å¤–ã«å®Ÿè¡Œã—ãŸã„ã‚­ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆã¯NSEventã‚’è¦‹ã¦å®Ÿè¡Œã•ã›ã‚‹
         */
        
        guard let currentEvent = view.window?.currentEvent, currentEvent.type == .keyDown else {
            return false
        }
        
        let modifierFlags = currentEvent.modifierFlags.intersection(.deviceIndependentFlagsMask)
        let firstKeyInputScalar = currentEvent.charactersIgnoringModifiers?.unicodeScalars.first

        // ãƒãƒƒãƒˆã§ã¯keyCode == 36ã¨ã„ã†ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’ã‚ˆãè¦‹ã‚‹ãŒã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚ã‚“ã¾ã‚ˆããªã„ãªãã¨æ€ã£ã¦NSEvent.SpecialKeyã®unicodeã‚¹ã‚«ãƒ©ã¨æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹
        let isTargetKeyPressed = firstKeyInputScalar == NSEvent.SpecialKey.enter.unicodeScalar || firstKeyInputScalar == NSEvent.SpecialKey.carriageReturn.unicodeScalar
        
        // ã“ã®ã‚±ãƒ¼ã‚¹ã§ã¯control + (enter or return)ãŒæŠ¼ã•ã‚ŒãŸå ´åˆã«è‡ªå‰å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹
        if modifierFlags == [.control] && isTargetKeyPressed {
            doSomethingYouWant()
            return true
        }

    }
            
    return false
}

```

# Shift + Enterã¨Enterã‚’åˆ¤åˆ¥ã™ã‚‹
é€šå¸¸ã€NSTextFieldã§ã¯Shift + Enterã¨Enterã¯ä¸¡æ–¹ã¨ã‚‚`insertNewline`ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã®ã§ã™ãŒã€
Numbersã®ã‚ˆã†ã«ã€ŒShift + Enterã§ã¯ä¸Šã®ã‚»ãƒ«ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»å‹•ã—ã€Enterã§ä¸‹ã®ã‚»ãƒ«ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã™ã‚‹ã€ã¨ã„ã†æŒ™å‹•ã‚’å®Ÿç¾ã—ãŸã„å ´åˆã¯ã€å°‘ã—ã‚³ãƒ¼ãƒ‰ã‚’å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```swift
func control(_ control: NSControl, textView: NSTextView, doCommandBy commandSelector: Selector) -> Bool {
    
    guard let currentEvent = view.window?.currentEvent, currentEvent.type == .keyDown else {
        return false
    }
    
    let modifierFlags = currentEvent.modifierFlags.intersection(.deviceIndependentFlagsMask)

    switch commandSelector {
    case #selector(insertNewline):
        if modifierFlags == .shift {
            // Shift + Enterã®éš›ã®ã‚³ãƒãƒ³ãƒ‰
        } else {
            // Enterã®æ™‚ã®ã‚³ãƒãƒ³ãƒ‰
        }
        return true
        
    default:
        return false
    }
            
}
```

ãŠã‚ã‚Šã§ã™ã€‚