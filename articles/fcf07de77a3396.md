---
title: "ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè£…ã™ã‚‹"
emoji: "ğŸ”¥"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Cocoa, AppKit, NSAnimationContext]
published: true
---

UIKitã®å ´åˆã¯ã€[UIView.animate(withDuration:animations:completion:)](https://developer.apple.com/documentation/uikit/uiview/1622515-animate)ã‚„[UIView.perform(_on:options:animations:completion:)](https://developer.apple.com/documentation/uikit/uiview/1622635-perform)ãªã©ã®ãƒ–ãƒ­ãƒƒã‚¯æ§‹æ–‡ã‚’ç”¨ã„ãŸãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿç¾ã—ã¦ã„ã¾ã—ãŸã€‚

ã“ã®è¨˜äº‹ã§ã¯ã€**AppKit**ã§ã®ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…æ–¹æ³•ã®ä¸­ã‹ã‚‰ã„ãã¤ã‹ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# å®Ÿè£…æ–¹æ³•
## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£1ã¤ã ã‘ã®å ´åˆ
[animator()](https://developer.apple.com/documentation/appkit/nsanimatablepropertycontainer/1530511-animator)ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚

ä¾‹ãˆã°ã€NSSplitViewã‚’ä½¿ã£ã¦Paneã®ãƒˆã‚°ãƒ«æŒ™å‹•ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§å®Ÿç¾ã™ã‚‹å ´åˆãªã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```swift
@objc func togglePane(sender: Any?) {

    paneSplitItem.animator().isCollapsed.toggle()

}
```

twitterã§@dy4_268ã•ã‚“ã«æ•™ãˆã¦é ‚ãã¾ã—ãŸï¼ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼
https://twitter.com/dy4_268/status/1613423855107985411?s=20&t=o8ajaWGAIsgoWcidw9FVYg

## 2ã¤ä»¥ä¸Šã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’åŒæ™‚ã«ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ãŸã„å ´åˆ
NSAnimationContextãŒåˆ©ç”¨ã§ãã¾ã™ã€‚ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯[NSGraphicContext](https://developer.apple.com/documentation/appkit/nsgraphicscontext)ã®ã‚ˆã†ãªAPIã§ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ“ä½œã‚’è¡Œã„ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

1. `current`ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®å–å¾—
2. `allowsImplicitAnimation`ã‚’`true`ã«ã‚»ãƒƒãƒˆ
3. ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ãŸã„ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®å¤‰æ›´
4. `allowsImplicitAnimation`ã‚’`false`ã«ã‚»ãƒƒãƒˆ

ä¾‹ãˆã°ã€NSSplitViewã‚’ä½¿ã£ã¦Paneã®ãƒˆã‚°ãƒ«æŒ™å‹•ã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã§å®Ÿç¾ã™ã‚‹å ´åˆãªã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè£…ã—ã¾ã™ã€‚

```swift
@objc func togglePane(sender: Any?) {

    let context = NSAnimationContext.current
    context.allowsImplicitAnimation = true
    paneSplitItem.isCollapsed.toggle()
    context.allowsImplicitAnimation = false

}
```

ä½•åº¦ã‚‚ã“ã‚Œã‚’æ›¸ãã®ã¯å¤§å¤‰ãªã®ã§ã€[CotEditor](https://coteditor.com)ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ç‹¬è‡ªã®ãƒ–ãƒ­ãƒƒã‚¯APIã‚’å®Ÿè£…ã—ã¦ä½¿ã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```swift
func withAnimation(_ animate: Bool = true, execute block: () -> Void) {
        
    let allowsImplicitAnimation = self.allowsImplicitAnimation
        
    self.allowsImplicitAnimation = animate
        
    block()
        
    self.allowsImplicitAnimation = allowsImplicitAnimation
}
```
(å¼•ç”¨: https://github.com/coteditor/CotEditor/blob/3a4e0fa54582cd5a5d895657c32079b1ead829db/CotEditor/Sources/NSAnimationContext.swift#L31)

ä¸Šè¨˜ã®ã‚ˆã†ãªAPIã‚’å®Ÿè£…ã—ã¦ãŠãã¨ã€åˆ©ç”¨å´ã‹ã‚‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã‚·ãƒ³ãƒ—ãƒ«ã«ä½¿ãˆã¾ã™ã€‚
```swift
NSAnimationContext.current.withAnimation {
    paneSplitItem.isCollapsed.toggle()
}
```