---
title: "NSTableViewã®selectionã§ãƒœãƒ¼ãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªä½œã™ã‚‹"
emoji: "ðŸŒŸ"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [Cocoa, AppKit, NSTableView, NSTableRowView]
published: true
---

AppKitã§ã¯è¡Œã®ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³è‰²ãªã©ã‚’ã‚«ã‚¹ã‚¿ãƒžã‚¤ã‚ºã—ãŸã„å ´åˆã¯ã€NSTableRowViewã‚’ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚åŸºæœ¬çš„ãªã“ã¨ã¯ä¸‹è¨˜ã®è¨˜äº‹ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚
https://qiita.com/usagimaru/items/281bda8e65efede484bb

ã“ã®è¨˜äº‹ã§ã¯ã€ãã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹å†…ã§ãƒœãƒ¼ãƒ€ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«ã‚’è‡ªä½œã™ã‚‹æ–¹æ³•ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚

# å‰æ
- NSTableViewã€ã‚‚ã—ãã¯ãã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã€‚
- è¤‡æ•°é¸æŠžã‚’è¨±å¯ã™ã‚‹

# æœ¬é¡Œ
å‚è€ƒè¨˜äº‹ã§ã¯NSBezierPathã«å¯¾ã—ã¦fillã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã—ãŸãŒã€ä»–ã®APIã‚’ä½¿ã†ã¨ã‚«ã‚¹ã‚¿ãƒ ã®ã‚»ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®Ÿè£…ã§ãã¾ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯borderã‚¹ã‚¿ã‚¤ãƒ«ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã«ã€[NSBezierPath.move(to:)](https://developer.apple.com/documentation/appkit/nsbezierpath/1520684-move)ã¨[NSBezierPath.line(to:)](https://developer.apple.com/documentation/appkit/nsbezierpath/1520742-line)ã‚’ä½¿ã„ã¾ã™ã€‚

NSTableRowViewã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«å¯¾ã—ã¦ã‚‚è§£èª¬ã‚’ã—ã¦ãŠãã¾ã™ã€‚
é¸æŠžä¸­ã‹ã©ã†ã‹ã®åˆ¤æ–­ãŒ[NSTableRowView.isSelected](https://developer.apple.com/documentation/appkit/nstablerowview/1529508-isselected)ã§è¡Œã‚ã‚Œã‚‹ã¨ã„ã†ã®ã¯UITableViewCellãªã©ã¨ä¼¼ãŸã‚ˆã†ãªæ„Ÿã˜ã§UIKit Developerã«ã¨ã£ã¦ã‚‚ç›´æ„Ÿçš„ã ã¨æ€ã„ã¾ã™ãŒã€AppKitã§ã¯[NSTableRowView.isEmphasized](https://developer.apple.com/documentation/appkit/nstablerowview/1526258-isemphasized)ã¨ã„ã†ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã§å‚ç…§ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ã‚¦ã‚¤ãƒ³ãƒ‰ã‚¦ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã„å ´åˆã«è¡ŒãŒã‚»ã‚«ãƒ³ãƒ€ãƒªã‚«ãƒ©ãƒ¼(éžã‚¢ã‚¯ãƒ†ã‚£ãƒ–ç”¨ã‚«ãƒ©ãƒ¼)ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚falseã®å ´åˆã«ã‚»ã‚«ãƒ³ãƒ€ãƒªã‚«ãƒ©ãƒ¼ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¾ã™ã€‚

> When emphasized is true, the view will draw with the alternateSelectedControlColor defined by NSColor. When false it will use the secondarySelectedControlColor defined by NSColor.
>
> (Copyright Â© 2023 Apple Inc. All rights reserved., https://developer.apple.com/documentation/appkit/nstablerowview/1526258-isemphasized, refer-date: 2023/01/24)

APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’èª­ã‚€ã¨ä¸Šè¨˜ã®ã‚ˆã†ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã™ãŒã€NSColorã®[alternateSelectedControlColor](https://developer.apple.com/documentation/appkit/nscolor/1533135-alternateselectedcontrolcolor)ã¨[secondarySelectedControlColor](https://developer.apple.com/documentation/appkit/nscolor/1535258-secondaryselectedcontrolcolor)ã¯macOS 11.0ã§deprecatedã«ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ä»£ã‚ã‚Šã«[selectedContentBackgroundColor](https://developer.apple.com/documentation/appkit/nscolor/2998830-selectedcontentbackgroundcolor)ã¨[unemphasizedSelectedContentBackgroundColor](https://developer.apple.com/documentation/appkit/nscolor/2998832-unemphasizedselectedcontentbackg)ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚

ã‚µãƒ³ãƒ—ãƒ«å®Ÿè£…ã¯ä¸‹è¨˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

```swift
class BorderSelectionTableRowView: NSTableRowView {

    // ã¤ã„ã§ã«ã“ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’.normalã§è¿”ã—ã¦ãŠãã¨ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è‰²ã®åè»¢ãŒèµ·ããªã„ã‚ˆã†ã«ã§ãã¾ã™ã€‚
    override var interiorBackgroundStyle: NSView.BackgroundStyle {
        return .normal
    }

    override func drawSelection(in dirtyRect: NSRect) {
        if isSelected {

            let strokeColor: NSColor = {
                if isEmphasized {
                    return .selectedContentBackgroundColor
                } else {
                    return .unemphasizedSelectedContentBackgroundColor
                }
            }()

            strokeColor.setStroke()

            let bezierPath = NSBezierPath()

            /*
             The top and bottom line is not drawn when the adjacent row is selected.
             This behavior refines multi selection experience.
             */
            // Top Line
            if !isPreviousRowSelected {
                bezierPath.move(to: .init(x: 0, y: 0))
                bezierPath.line(to: .init(x: bounds.maxX, y: 0))
            }

            // Bottom Line
            if !isNextRowSelected {
                bezierPath.move(to: .init(x: 0, y: bounds.maxY))
                bezierPath.line(to: .init(x: bounds.maxX, y: bounds.maxY))
            }

            // Leading Line
            bezierPath.move(to: .init(x: 0, y: 0))
            bezierPath.line(to: .init(x: 0, y: bounds.maxY))

            // Trailing Line
            bezierPath.move(to: .init(x: bounds.maxX, y: 0))
            bezierPath.line(to: .init(x: bounds.maxX, y: bounds.maxY))

            bezierPath.lineWidth = 3
            bezierPath.stroke()
        }
    }
    

}

```

å°‘ã—UIã‚’è‰¯ãã™ã‚‹ãŸã‚ã®å·¥å¤«ã¨ã—ã¦ã€è¤‡æ•°é¸æŠžæ™‚ã«éš£æŽ¥ã™ã‚‹è¡ŒãŒé¸æŠžã•ã‚Œã¦ã„ã‚‹å ´åˆã¯é€£ç¶šéƒ¨åˆ†ã®ãƒœãƒ¼ãƒ€ãƒ¼ã‚’è¡¨ç¤ºã—ãªã„ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯NSTableViewã®[isPreviousRowSelected](https://developer.apple.com/documentation/appkit/nstablerowview/1535313-ispreviousrowselected)ã¨[isNextRowSelected](https://developer.apple.com/documentation/appkit/nstablerowview/1529083-isnextrowselected)ã‚’åˆ©ç”¨ã™ã‚‹ã¨åˆ¤åˆ¥ã§ãã¾ã™(ä¾¿åˆ©ã§ã™ã­ï¼)

ä¸€ã¤å‰ã®è¡ŒãŒé¸æŠžã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä¸Šã®ãƒ©ã‚¤ãƒ³ã‚’å¼•ã‹ãªã„ã‚ˆã†ã«ã€ä¸€ã¤ä¸‹ã®è¡ŒãŒé¸æŠžã•ã‚Œã¦ã„ã‚‹å ´åˆã¯ä¸‹ã®ãƒ©ã‚¤ãƒ³ã‚’å¼•ã‹ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã‚ã¨ã¯å¤ªã•ã‚’æŒ‡å®šã—ã¦[NSBezierPath.stroke()](https://developer.apple.com/documentation/appkit/nsbezierpath/1520739-stroke)ã‚’å‘¼ã¹ã°ã“ã®ã‚µãƒ–ã‚¯ãƒ©ã‚¹ã¯å®Œæˆã§ã™ã€‚

# ã‚«ã‚¹ã‚¿ãƒ NSTableRowViewã®åˆ©ç”¨
## NSTableViewDelegateã®å ´åˆ
```swift
func tableView(_ tableView: NSTableView, rowViewForRow row: Int) -> NSTableRowView? {
    let identifier = NSUserInterfaceItemIdentifier(rawValue: "Row")
    var rowView = tableView.makeView(withIdentifier: identifier, owner: self) as? BorderSelectionTableRowView
    if rowView == nil {
        rowView = BorderSelectionTableRowView(frame: NSZeroRect)
        rowView?.identifier = identifier
    }

    return rowView
}

```

## NSOutlineViewDelegateã®å ´åˆ
```swift
func outlineView(_ outlineView: NSOutlineView, rowViewForItem item: Any) -> NSTableRowView? {
    let identifier = NSUserInterfaceItemIdentifier(rawValue: "Row")
    var rowView = outlineView.makeView(withIdentifier: identifier, owner: self) as? BorderSelectionTableRowView
    if rowView == nil {
        rowView = BorderSelectionTableRowView(frame: NSZeroRect)
        rowView?.identifier = identifier
    }

    return rowView
}
```
